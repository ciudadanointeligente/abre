<div id="<%= dom_id(proposal) %>"
     class="proposal clear <%= ("successful" if proposal.total_votes > Proposal.votes_needed_for_success) %>"
     data-type="proposal">
    <div class="icon-successful"></div>
    <div class="">

      <div class="">
        <div class="proposal-content">
          <% cache [locale_and_user_status(proposal), 'index', proposal, proposal.author] do %>
            <h4 class="small blue total-votes-text">
              <span class="total-votes-count"><%= proposal.total_votes %> </span> vecinos apoyan esta propuesta
              <% if proposal.successful? %>
                <span data-tooltip aria-haspopup="true" class="has-tip top" data-disable-hover="false" tabindex="2" title="Esta propuesta esta dentro de las 3 más votadas del desafío"><i class="fa fa-heart has-tip animated infinite pulse2" style="font-size:1rem;"> </i></span>
              <% end %>
            </h4>
            <h4><%= link_to proposal.title, namespaced_proposal_path(proposal) %></h3>
            <p class="">
              <i class="fa fa-map-marker"></i> <%= proposal.geozones_name %> <span class="line-text">|</span>
              <i class="fa fa-calendar"> </i> <%= l proposal.created_at.to_date %>
              <% if proposal.author.hidden? || proposal.author.erased? %>
                <span class="line-text">|</span> <i class="fa fa-user-o"> </i>
                <span><%= t("proposals.show.author_deleted") %></span>
              <% else %>
              <span class="line-text">|</span> <i class="fa fa-user-o"> </i>
                <span class> <%= proposal.responsible_name %> </span>
              <% end %>
            </p>
            <div class="proposal-description">
              <p><%= proposal.summary %><span><a href="#"><%= link_to ' Ver más', namespaced_proposal_path(proposal) %></a></span></p>
            </div>
          <% end %>
          <%= render "shared/tags", taggable: proposal, limit: 5 %>
        </div>

        <div>
          <% if proposal.successful? && proposal.problem.ends_at < Date.today %>
          <div class="">
            <div class="padding text-left bg-blue">
              <p class="white">
                Ha finalizado el tiempo de recepción de propuestas, y esta propuesta ha estado dentro de las 3 más votadas y pasará a la próxima votación.
              </p>
            </div>
          </div>
          <% elsif proposal.problem.ends_at < Date.today %>
            <div class="">
              <div class="padding text-left bg-blue">
                <p class="white">
                  Ha finalizado el tiempo de recepción de propuestas.
                </p>
              </div>
            </div>
          <% elsif proposal.archived? %>
            <div class="">
              <div class="padding text-center">
                <strong><%= t("proposals.proposal.supports", count: proposal.total_votes) %></strong>
                <p><%= t("proposals.proposal.archived") %></p>
              </div>
            </div>
          <% else %>
            <div class="">
              <%= render 'votes',
                      { proposal: proposal, vote_url: vote_proposal_path(proposal, value: 'yes'), button_support_class: '' } %>
            </div>
          <% end %>


<!-- Si es administrador puede apoyar propuestas en nombre de otro -->

  <% if !current_user.nil? && current_user.administrator? %>
    <p><button class="button" data-open="exampleModal1">Click me for a modal</button></p>

    <div class="reveal" id="exampleModal1" data-reveal>
      <p class="label float-left"> Apoyo de propuestas </p>
      <h4><%= proposal.title %> </h4>

      <%= form_for(:vote, url: vote_proposal_path(proposal, value: 'yes')) do |f| %>
        <%= f.text_field :nombre %> 
        <%= f.text_field :rut %>
        <%= f.text_field :telefono %>
        <%= f.submit(class: "button float-right", value: "Apoyar esta propuesta") %>
        <!-- <%= render 'votes',
                { proposal: proposal, vote_url: vote_proposal_path(proposal, value: 'yes'), button_support_class: '' } %> -->

      <% end %>
      <button class="close-button gray" data-close aria-label="Close modal" type="button">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
  <% end %>


        </div>
      </div>

      <div id="<%= dom_id(proposal) %>_votes" class="small-12 medium-12 column supports-container">

      </div>

    </div>
</div>
